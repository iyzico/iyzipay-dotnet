name: .NET for Test

on:
  pull_request:
    branches: [ "master" ]

jobs:
  test:

    runs-on: ubuntu-18.04

    steps:
    - uses: actions/checkout@v3
    - name: Setup .NET 4
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '2.1.x'
    - name: Build
      run: dotnet build -c Release Iyzipay
    - name: NETCORE1 Tests
      run: |
        #curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
        #sudo mv microsoft.gpg /etc/apt/trusted.gpg.d/microsoft.gpg
        #sudo sh -c 'echo "deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-ubuntu-trusty-prod trusty main" > /etc/apt/sources.list.d/dotnetdev.list'
        #wget -nv https://packages.microsoft.com/config/ubuntu/18.04/packages-microsoft-prod.deb
        #sudo dpkg -i packages-microsoft-prod.deb
        #sudo add-apt-repository universe
        #sudo apt-get install apt-transport-https
        #sudo apt-get update
        #sudo apt-get install dotnet-dev-1.1.14
        wget -q https://download.microsoft.com/download/D/7/A/D7A9E4E9-5D25-4F0C-B071-210CB8267943/dotnet-ubuntu-x64.1.1.2.tar.gz
        ls -l
        sudo mkdir -p $HOME/dotnet && sudo tar zxf dotnet-ubuntu-x64.1.1.2.tar.gz -C $HOME/dotnet
        sudo export PATH=$PATH:$HOME/dotnet
        dotnet test -c Release Iyzipay.Tests -f netcoreapp1.1
    - name: NET45 Tests
      run: dotnet test -c Release Iyzipay.Tests -f net45
    - name: NETCORE2 Tests
      run: dotnet test -c Release Iyzipay.Tests -f netcoreapp2.0
